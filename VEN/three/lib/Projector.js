THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0,this.renderOrder=0},THREE.RenderableFace=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.color=new THREE.Color,this.material=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0,this.renderOrder=0},THREE.RenderableVertex=function(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0,this.renderOrder=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new THREE.Vector2,this.material=null,this.renderOrder=0},THREE.Projector=function(){var ne,oe,n,ae,se,le,ce,pe,Ee,ue,de,he=[],fe=0,me=[],r=0,t=[],i=0,o=[],a=0,s=[],l=0,ve={objects:[],lights:[],elements:[]},Re=new THREE.Vector3,xe=new THREE.Vector4,f=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),m=new THREE.Box3,v=new Array(3),ye=(new Array(4),new THREE.Matrix4),Te=new THREE.Matrix4,He=new THREE.Matrix4,we=new THREE.Matrix3,ge=new THREE.Frustum,be=new THREE.Vector4,Me=new THREE.Vector4;this.projectVector=function(e,r){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(r)},this.unprojectVector=function(e,r){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(r)},this.pickingRay=function(e,r){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var Se=new function(){var l=[],c=[],p=null,E=null,u=new THREE.Matrix3;function i(e){var r=e.position,t=e.positionWorld,i=e.positionScreen;t.copy(r).applyMatrix4(de),i.copy(t).applyMatrix4(Te);var n=1/i.w;i.x*=n,i.y*=n,i.z*=n,e.visible=-1<=i.x&&i.x<=1&&-1<=i.y&&i.y<=1&&-1<=i.z&&i.z<=1}function d(e,r,t){return!0===e.visible||!0===r.visible||!0===t.visible||(v[0]=e.positionScreen,v[1]=r.positionScreen,v[2]=t.positionScreen,f.intersectsBox(m.setFromPoints(v)))}function h(e,r,t){return(t.positionScreen.x-e.positionScreen.x)*(r.positionScreen.y-e.positionScreen.y)-(t.positionScreen.y-e.positionScreen.y)*(r.positionScreen.x-e.positionScreen.x)<0}return{setObject:function(e){E=(p=e).material,u.getNormalMatrix(p.matrixWorld),l.length=0,c.length=0},projectVertex:i,checkTriangleVisibility:d,checkBackfaceCulling:h,pushVertex:function(e,r,t){(n=ze()).position.set(e,r,t),i(n)},pushNormal:function(e,r,t){l.push(e,r,t)},pushUv:function(e,r){c.push(e,r)},pushLine:function(e,r){var t=me[e],i=me[r];(ce=je()).id=p.id,ce.v1.copy(t),ce.v2.copy(i),ce.z=(t.positionScreen.z+i.positionScreen.z)/2,ce.renderOrder=p.renderOrder,ce.material=p.material,ve.elements.push(ce)},pushTriangle:function(e,r,t){var i=me[e],n=me[r],o=me[t];if(!1!==d(i,n,o)&&(E.side===THREE.DoubleSide||!0===h(i,n,o))){(se=Ve()).id=p.id,se.v1.copy(i),se.v2.copy(n),se.v3.copy(o),se.z=(i.positionScreen.z+n.positionScreen.z+o.positionScreen.z)/3,se.renderOrder=p.renderOrder,se.normalModel.fromArray(l,3*e),se.normalModel.applyMatrix3(u).normalize();for(var a=0;a<3;a++){var s=se.vertexNormalsModel[a];s.fromArray(l,3*arguments[a]),s.applyMatrix3(u).normalize(),se.uvs[a].fromArray(c,2*arguments[a])}se.vertexNormalsLength=3,se.material=p.material,ve.elements.push(se)}}}};function ze(){if(ae!==r)return me[ae++];var e=new THREE.RenderableVertex;return me.push(e),r++,ae++,e}function Ve(){if(le!==i)return t[le++];var e=new THREE.RenderableFace;return t.push(e),i++,le++,e}function je(){if(pe!==a)return o[pe++];var e=new THREE.RenderableLine;return o.push(e),a++,pe++,e}function Oe(){if(ue!==l)return s[ue++];var e=new THREE.RenderableSprite;return s.push(e),l++,ue++,e}function Ce(e,r){return e.renderOrder!==r.renderOrder?e.renderOrder-r.renderOrder:e.z!==r.z?r.z-e.z:e.id!==r.id?e.id-r.id:0}this.projectScene=function(e,r,t,i){function n(e){(ne=function(){if(oe!==fe)return he[oe++];var e=new THREE.RenderableObject;return he.push(e),fe++,oe++,e}()).id=e.id,ne.object=e,Re.setFromMatrixPosition(e.matrixWorld),Re.applyMatrix4(Te),ne.z=Re.z,ne.renderOrder=e.renderOrder,ve.objects.push(ne)}ue=pe=le=0,!(ve.elements.length=0)===e.autoUpdate&&e.updateMatrixWorld(),null===r.parent&&r.updateMatrixWorld(),ye.copy(r.matrixWorldInverse.getInverse(r.matrixWorld)),Te.multiplyMatrices(r.projectionMatrix,ye),ge.setFromMatrix(Te),oe=0,ve.objects.length=0,ve.lights.length=0,e.traverseVisible(function(e){if(e instanceof THREE.Light)ve.lights.push(e);else if(e instanceof THREE.Mesh||e instanceof THREE.Line){if(!1===e.material.visible)return;if(!0===e.frustumCulled&&!1===ge.intersectsObject(e))return;n(e)}else if(e instanceof THREE.Sprite){if(!1===e.material.visible)return;if(!0===e.frustumCulled&&!1===ge.intersectsSprite(e))return;n(e)}}),!0===t&&ve.objects.sort(Ce);for(var o=0,a=ve.objects.length;o<a;o++){var s=ve.objects[o].object,l=s.geometry;if(Se.setObject(s),de=s.matrixWorld,ae=0,s instanceof THREE.Mesh){if(l instanceof THREE.BufferGeometry){var c=l.attributes,p=l.groups;if(void 0===c.position)continue;for(var E=0,u=(K=c.position.array).length;E<u;E+=3)Se.pushVertex(K[E],K[E+1],K[E+2]);if(void 0!==c.normal){var d=c.normal.array;for(E=0,u=d.length;E<u;E+=3)Se.pushNormal(d[E],d[E+1],d[E+2])}if(void 0!==c.uv){var h=c.uv.array;for(E=0,u=h.length;E<u;E+=2)Se.pushUv(h[E],h[E+1])}if(null!==l.index){var f=l.index.array;if(0<p.length)for(var m=0;m<p.length;m++){var v=p[m];for(E=v.start,u=v.start+v.count;E<u;E+=3)Se.pushTriangle(f[E],f[E+1],f[E+2])}else for(E=0,u=f.length;E<u;E+=3)Se.pushTriangle(f[E],f[E+1],f[E+2])}else for(E=0,u=K.length/3;E<u;E+=3)Se.pushTriangle(E,E+1,E+2)}else if(l instanceof THREE.Geometry){var R=l.vertices,x=l.faces,y=l.faceVertexUvs[0];we.getNormalMatrix(de);for(var T=s.material,H=T instanceof THREE.MultiMaterial,w=1==H?s.material:null,g=0,b=R.length;g<b;g++){var M=R[g];if(Re.copy(M),!0===T.morphTargets)for(var S=l.morphTargets,z=s.morphTargetInfluences,V=0,j=S.length;V<j;V++){var O=z[V];if(0!==O){var C=S[V].vertices[g];Re.x+=(C.x-M.x)*O,Re.y+=(C.y-M.y)*O,Re.z+=(C.z-M.z)*O}}Se.pushVertex(Re.x,Re.y,Re.z)}for(var L=0,k=x.length;L<k;L++){var N=x[L];if(void 0!==(T=1==H?w.materials[N.materialIndex]:s.material)){var W=T.side,B=me[N.a],F=me[N.b],P=me[N.c];if(!1!==Se.checkTriangleVisibility(B,F,P)){var A=Se.checkBackfaceCulling(B,F,P);if(W!==THREE.DoubleSide){if(W===THREE.FrontSide&&!1===A)continue;if(W===THREE.BackSide&&!0===A)continue}(se=Ve()).id=s.id,se.v1.copy(B),se.v2.copy(F),se.v3.copy(P),se.normalModel.copy(N.normal),!1!==A||W!==THREE.BackSide&&W!==THREE.DoubleSide||se.normalModel.negate(),se.normalModel.applyMatrix3(we).normalize();for(var D=N.vertexNormals,G=0,I=Math.min(D.length,3);G<I;G++){var U=se.vertexNormalsModel[G];U.copy(D[G]),!1!==A||W!==THREE.BackSide&&W!==THREE.DoubleSide||U.negate(),U.applyMatrix3(we).normalize()}se.vertexNormalsLength=D.length;var q=y[L];if(void 0!==q)for(var J=0;J<3;J++)se.uvs[J].copy(q[J]);se.color=N.color,se.material=T,se.z=(B.positionScreen.z+F.positionScreen.z+P.positionScreen.z)/3,se.renderOrder=s.renderOrder,ve.elements.push(se)}}}}}else if(s instanceof THREE.Line){if(l instanceof THREE.BufferGeometry){if(void 0!==(c=l.attributes).position){var K;for(E=0,u=(K=c.position.array).length;E<u;E+=3)Se.pushVertex(K[E],K[E+1],K[E+2]);if(null!==l.index)for(E=0,u=(f=l.index.array).length;E<u;E+=2)Se.pushLine(f[E],f[E+1]);else{var Q=s instanceof THREE.LineSegments?2:1;for(E=0,u=K.length/3-1;E<u;E+=Q)Se.pushLine(E,E+1)}}}else if(l instanceof THREE.Geometry){if(He.multiplyMatrices(Te,de),0===(R=s.geometry.vertices).length)continue;for((B=ze()).positionScreen.copy(R[0]).applyMatrix4(He),Q=s instanceof THREE.LineSegments?2:1,g=1,b=R.length;g<b;g++)(B=ze()).positionScreen.copy(R[g]).applyMatrix4(He),0<(g+1)%Q||(F=me[ae-2],be.copy(B.positionScreen),Me.copy(F.positionScreen),!0==(Z=Me,_=$=void 0,$=0,_=1,ee=(Y=be).z+Y.w,re=Z.z+Z.w,te=-Y.z+Y.w,ie=-Z.z+Z.w,0<=ee&&0<=re&&0<=te&&0<=ie||!(ee<0&&re<0||te<0&&ie<0)&&(ee<0?$=Math.max($,ee/(ee-re)):re<0&&(_=Math.min(_,ee/(ee-re))),te<0?$=Math.max($,te/(te-ie)):ie<0&&(_=Math.min(_,te/(te-ie))),!(_<$||(Y.lerp(Z,$),Z.lerp(Y,1-_),0))))&&(be.multiplyScalar(1/be.w),Me.multiplyScalar(1/Me.w),(ce=je()).id=s.id,ce.v1.positionScreen.copy(be),ce.v2.positionScreen.copy(Me),ce.z=Math.max(be.z,Me.z),ce.renderOrder=s.renderOrder,ce.material=s.material,s.material.vertexColors===THREE.VertexColors&&(ce.vertexColors[0].copy(s.geometry.colors[g]),ce.vertexColors[1].copy(s.geometry.colors[g-1])),ve.elements.push(ce)))}}else if(s instanceof THREE.Sprite){xe.set(de.elements[12],de.elements[13],de.elements[14],1),xe.applyMatrix4(Te);var X=1/xe.w;xe.z*=X,-1<=xe.z&&xe.z<=1&&((Ee=Oe()).id=s.id,Ee.x=xe.x*X,Ee.y=xe.y*X,Ee.z=xe.z,Ee.renderOrder=s.renderOrder,Ee.object=s,Ee.rotation=s.rotation,Ee.scale.x=s.scale.x*Math.abs(Ee.x-(xe.x+r.projectionMatrix.elements[0])/(xe.w+r.projectionMatrix.elements[12])),Ee.scale.y=s.scale.y*Math.abs(Ee.y-(xe.y+r.projectionMatrix.elements[5])/(xe.w+r.projectionMatrix.elements[13])),Ee.material=s.material,ve.elements.push(Ee))}}var Y,Z,$,_,ee,re,te,ie;return!0===i&&ve.elements.sort(Ce),ve}};