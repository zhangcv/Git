<!DOCTYPE html><html class="theme-next muse use-motion" lang="en"><head><meta name="generator" content="Hexo 3.8.0"><script type="text/javascript" src="/js/love.js"></script><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><script src="/VEN/pace/pace.min.js?v=1.0.2"></script><link rel="stylesheet" href="/VEN/pace/pace-theme-minimal.min.css?v=1.0.2"><link rel="stylesheet" href="/VEN/font-awesome/css/font-awesome.min.css?v=4.6.2"><link rel="stylesheet" href="/css/main.css?v=7.0.1"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.1"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.1"><link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222"><script id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Muse",version:"7.0.1",sidebar:{position:"left",display:"hide",offset:12,onmobile:!1,dimmer:!0},back2top:!0,back2top_sidebar:!1,fancybox:!1,fastclick:!1,lazyload:!1,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="description" content="Mysql连接方式和 Springmvc接受参数@RequestParam和 @PathVariable接受参数如果请求中有多个同名的应该如何接收呢？如给用户授权时，可能授予多个权限，首先看下如下代码：@RequestParam123public String requestparam7(@RequestParam(value=&quot;role&quot;) String roleList)或者public St"><meta name="keywords" content="Mysql"><meta property="og:type" content="article"><meta property="og:title" content="Mysql学习 (补充)"><meta property="og:url" content="http://zhangcv.github.io/2019/10/08/2019-10-08/index.html"><meta property="og:site_name" content="Zhangcv&#39;s Personal Website"><meta property="og:description" content="Mysql连接方式和 Springmvc接受参数@RequestParam和 @PathVariable接受参数如果请求中有多个同名的应该如何接收呢？如给用户授权时，可能授予多个权限，首先看下如下代码：@RequestParam123public String requestparam7(@RequestParam(value=&quot;role&quot;) String roleList)或者public St"><meta property="og:locale" content="en"><meta property="og:image" content="http://zhangcv.github.io/2019/10/08/2019-10-08/1.jpg"><meta property="og:updated_time" content="2019-10-09T03:30:03.037Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Mysql学习 (补充)"><meta name="twitter:description" content="Mysql连接方式和 Springmvc接受参数@RequestParam和 @PathVariable接受参数如果请求中有多个同名的应该如何接收呢？如给用户授权时，可能授予多个权限，首先看下如下代码：@RequestParam123public String requestparam7(@RequestParam(value=&quot;role&quot;) String roleList)或者public St"><meta name="twitter:image" content="http://zhangcv.github.io/2019/10/08/2019-10-08/1.jpg"><link rel="canonical" href="http://zhangcv.github.io/2019/10/08/2019-10-08/"><script id="page.configurations">CONFIG.page={sidebar:""}</script><title>Mysql学习 (补充) | Zhangcv's Personal Website</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="en"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Zhangcv's Personal Website</span><span class="logo-line-after"><i></i></span></a></div></div><div class="site-nav-toggle"> <button aria-label="Toggle navigation bar"><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-question-circle"></i><br>Tags<span class="badge">18</span></a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-question-circle"></i><br>Categories<span class="badge">19</span></a></li><li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>Archives<span class="badge">102</span></a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="menu-item-icon fa fa-fw fa-question-circle"></i><br>Commonweal 404</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>Search</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav><script>window.onload=function(){for(var t="https://zhangcv.github.io/",o=String(window.location).split(t)[1],l=document.querySelectorAll("#menu > li > a"),i=0;i<l.length;i++){var n=String(l[i].href).split(t)[1];n==o&&null!=n&&l[i].setAttribute("style","border-bottom:1px solid black")}}</script></div> <a href="https://github.com/zhangcv" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://zhangcv.github.io/2019/10/08/2019-10-08/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Jack"><meta itemprop="description" content="Jack's Ideas & Blogs"><meta itemprop="image" content="/images/avatar.gif"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Zhangcv's Personal Website"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Mysql学习 (补充)</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2019-10-08 21:31:30" itemprop="dateCreated datePublished" datetime="2019-10-08T21:31:30+08:00">2019-10-08</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Mysql/" itemprop="url" rel="index"><span itemprop="name">Mysql</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="Mysql连接方式和-Springmvc接受参数"><a href="#Mysql连接方式和-Springmvc接受参数" class="headerlink" title="Mysql连接方式和 Springmvc接受参数"></a>Mysql连接方式和 Springmvc接受参数</h2><h3 id="RequestParam和-PathVariable接受参数"><a href="#RequestParam和-PathVariable接受参数" class="headerlink" title="@RequestParam和 @PathVariable接受参数"></a>@RequestParam和 @PathVariable接受参数</h3><p>如果请求中有多个同名的应该如何接收呢？如给用户授权时，可能授予多个权限，首先看下如下代码：<br>@RequestParam<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public String requestparam7(@RequestParam(value=<span class="string">"role"</span>) String roleList)</span><br><span class="line">或者</span><br><span class="line">public String requestparam8(@RequestParam(value=<span class="string">"list"</span>) List&lt;String&gt; list)</span><br></pre></td></tr></table></figure><p></p><p>@PathVariable 绑定URI模板变量值<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(value=<span class="string">"/users/&#123;userId&#125;/topics/&#123;topicId&#125;"</span>)  </span><br><span class="line">public String <span class="built_in">test</span>(  </span><br><span class="line">       @PathVariable(value=<span class="string">"userId"</span>) int userId,   </span><br><span class="line">       @PathVariable(value=<span class="string">"topicId"</span>) int topicId)</span><br></pre></td></tr></table></figure><p></p><p>请求的URL为“控制器URL/users/123/topics/456”，则自动将URL中模板变量{userId}和{topicId}绑定到通过@PathVariable注解的同名参数上，即入参后userId=123、topicId=456</p><p>Mysql</p><h3 id="inset-…select"><a href="#inset-…select" class="headerlink" title="inset …select"></a>inset …select</h3><p>insert … select 插入记录</p><p>select goods_cate From tdb_goods group by goods_cate<br>查到7条数据<br>7次insert into 或者<br>insert tdb_good_cates(cate_name) select goods_cate From tdb_goods group by goods_cate</p><h3 id="多表更新"><a href="#多表更新" class="headerlink" title="多表更新"></a>多表更新</h3><p>update tdb_goods INNER JOIN tdb_goods_cate ON goods_cate = cate_name<br>SET goods_cate = cate_id;</p><h3 id="CREATE-…SELECT"><a href="#CREATE-…SELECT" class="headerlink" title="CREATE …SELECT"></a>CREATE …SELECT</h3><p>CREATE TABLE tdb_goods_brands ( brand_id SMALLINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,brand_name VARCHAR(40) NOT NULL)<br>SELECT brand_name FROM tdb_goods GROUP BY brand_name;</p><p>然后更新表中 小米 为序号<br>update tdb_goods g INNER JOIN tdb_goods_brands gb ON g.brand_name = gb.brand_name<br>SET g.brand_name = gb.brand_id;<br>然后修改 数据结构 varchar 改成smallint</p><p>？没有设置外键<br>显示给用户 采用连接查询</p><h3 id="内连接-交集"><a href="#内连接-交集" class="headerlink" title="内连接 交集"></a>内连接 交集</h3><p>商品分类表中不存在，商品俩交集 不存在或者未使用</p><h3 id="外连接"><a href="#外连接" class="headerlink" title="外连接"></a>外连接</h3><p>显示左表的全部记录及右表符合连接条件的记录<br>显示右表的全部记录及左表符合连接条件的记录</p><p>SELECT goods_id,goods_name,cate_name,brand_name,goods_price FROM tdb_goods g<br>INNER JOIN tdb_goods_cates gc on g.cate_id = gc.cate_id<br>INNER JOIN tdb_goods_brands gb on g.cate_id = gb.brand_id;</p><p>A LEFT JOIN B join_condition<br>如果数据表A的某条记录符合WHERE条件，但是在数据库表B中不存在符合连接条件的记录，将会生成一个所有列为空的额外的B行</p><h3 id="自身连接"><a href="#自身连接" class="headerlink" title="自身连接"></a>自身连接</h3><p>数据表中存放<br>一级分类 、二级分类(parent_id 为一级分类的Id)</p><h4 id="查询子类与子类的父类"><a href="#查询子类与子类的父类" class="headerlink" title="查询子类与子类的父类"></a>查询子类与子类的父类</h4><p>SELECT gs.type_id,gs.type_name,gp.type_name FROM tdb_goods_types gs<br>LEFT JOIN tdb_goods_types gp<br>ON gs.parent_id = gp.type_id;</p><h4 id="查询父类与父类下的子类"><a href="#查询父类与父类下的子类" class="headerlink" title="查询父类与父类下的子类"></a>查询父类与父类下的子类</h4><p>select gp.type_id,gp.type_name,gs.type_name FROM tdb_goods_types gp<br>LEFT JOIN tdb_goods_types gs<br>ON gs.parent_id = gp.type_id</p><p>查询父类与父类下的子类数目<br>select gp.type_id,gp.type_name,count(gs.type_name)child_count FROM tdb_goods_types gp<br>LEFT JOIN tdb_goods_types gs<br>ON gs.parent_id = gp.type_id group by gp.type_name order by p.type_id;</p><h3 id="多表删除"><a href="#多表删除" class="headerlink" title="多表删除"></a>多表删除</h3><p>SELECT goods_id,goods_name FROM td_goods GROUP BY goods_name having count(goods_name) &gt;=2</p><p>查询重复的数据是18，19 把大于18,19的重复的数据删除<br>DELETE t1 FROM tdb_goods t1<br>LEFT JOIN (SELECT goods_id,goods_name FROM td_goods GROUP BY goods_name having count(goods_name) &gt;=2) t2<br>ON t1.goods_name=t2.goods_name<br>WHERE t1.goods_id &gt;t2.goods_id;</p><h2 id="Mysql-高级应用"><a href="#Mysql-高级应用" class="headerlink" title="Mysql 高级应用"></a>Mysql 高级应用</h2><h3 id="索引优化"><a href="#索引优化" class="headerlink" title="索引优化"></a>索引优化</h3><p>1、索引优化 ( 在大的数据量查询 )<br>如何提高效率，充分利用索引<br>2、数据库函数(用户数据库函数导入大测试数据)<br>3、数据库锁 操作库存，redis(如何防止库存超卖)</p><h4 id="运行顺序"><a href="#运行顺序" class="headerlink" title="运行顺序"></a>运行顺序</h4><p>Mysql 顺序<br>SELECT *FROM<br>JOIN ON<br>WHERE<br>Group BY<br>HAVING<br>ORDER BY<br>LIMIT<br><img src="/2019/10/08/2019-10-08/1.jpg" alt="无"><br>机器执行的顺序<br>FROM<br>JOIN ON<br>WHERE<br>GROUP BY<br>HAVING<br>SELECT<br>ORDER BY<br>LIMIT</p><h4 id="连接的方式"><a href="#连接的方式" class="headerlink" title="连接的方式"></a>连接的方式</h4><p>常见的三种 left right inner</p><p>在left 去掉左右交集的部分<br>SELECT &lt;select_list&gt;<br>FROM TableA a<br>LEFT join TableB b<br>ON a.key = b.key<br>WHERE b.key IS NULL</p><p>右去掉左右交集的部分<br>同</p><p>AB全集合 外连接 UNION ALL 用法一样 FULL OUTER JOIN<br>SELECT &lt;select_list&gt;<br>FROM TableA a<br>FULL OUTER JOIN TableB b<br>ON a.key = b.key</p><p>AB 交集的部分不要了<br>SELECT &lt;select_list&gt;<br>FROM TableA a<br>FULL OUTER JOIN TableB b<br>ON a.key = b.key<br>WHERE a.key is null<br>OR b.key is null</p><p>Mysql 官方对索引的定义为 ：索引(Index) 是帮助Mysql 高效获取数据的数据结构。<br> 可以得到索引的本质： 索引是数据结构。<br> B树 Balance Tree 多路平衡查找树 为了加快Col2的查找，可以维护一个右边所示的二叉查找树，每个结点分别包含索引键值和一个指向对应数据记录物理地址的指针，这样就可以运用二叉查找在一定的复杂度内获取到相应数据，从而快速的检索除符合条件的记录<br> Hash索引 full-text全文索引 R-Tree索引等</p><h4 id="索引的分类"><a href="#索引的分类" class="headerlink" title="索引的分类"></a>索引的分类</h4><p> 单值索引 ： 一个索引只包含单个列，一个表可以有多个单列索引<br> 唯一索引 ： 索引列的值必须唯一，但允许有空值。<br> 复合索引 ： 一个索引包含多个列</p><p> 基本语法 ：<br> 创建： CRATE [UNIQUE] INDEX indexName ON mytable(col1,col2,col3…);<br> ALTER TABLE 表名 ADD [UNIQUE] INDEX [indexName] ON (colomnname(length))<br> 删除: DROP INDEX [indexName] ON mytable;<br> 查看：SHOW INDEX FROM table_name\G<br> 以上为 Linux命令</p></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/Mysql/" rel="tag"># Mysql</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2019/10/06/2019-10-06/" rel="next" title="git问题 SSH连不上"><i class="fa fa-chevron-left"></i> git问题 SSH连不上</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/2019/10/09/2019-10-09/" rel="prev" title="总结(一)">总结(一)<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> Table of Contents</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> Overview</li></ul><div class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="Jack"><p class="site-author-name" itemprop="name">Jack</p><div class="site-description motion-element" itemprop="description">Jack's Ideas & Blogs</div></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives"><span class="site-state-item-count">102</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories"><span class="site-state-item-count">19</span> <span class="site-state-item-name">categories</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags"><span class="site-state-item-count">18</span> <span class="site-state-item-name">tags</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3poYW5nY3Y=" title="GitHub &rarr; https://github.com/zhangcv"><i class="fa fa-fw fa-github"></i> GitHub</span></span><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS96aGFuZ2N2MjAxNw==" title="Twitter &rarr; https://twitter.com/zhangcv2017"><i class="fa fa-fw fa-twitter"></i> Twitter</span></span></div></div></div><div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Mysql连接方式和-Springmvc接受参数"><span class="nav-number">1.</span> <span class="nav-text">Mysql连接方式和 Springmvc接受参数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#RequestParam和-PathVariable接受参数"><span class="nav-number">1.1.</span> <span class="nav-text">@RequestParam和 @PathVariable接受参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#inset-…select"><span class="nav-number">1.2.</span> <span class="nav-text">inset …select</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多表更新"><span class="nav-number">1.3.</span> <span class="nav-text">多表更新</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CREATE-…SELECT"><span class="nav-number">1.4.</span> <span class="nav-text">CREATE …SELECT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#内连接-交集"><span class="nav-number">1.5.</span> <span class="nav-text">内连接 交集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#外连接"><span class="nav-number">1.6.</span> <span class="nav-text">外连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自身连接"><span class="nav-number">1.7.</span> <span class="nav-text">自身连接</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#查询子类与子类的父类"><span class="nav-number">1.7.1.</span> <span class="nav-text">查询子类与子类的父类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#查询父类与父类下的子类"><span class="nav-number">1.7.2.</span> <span class="nav-text">查询父类与父类下的子类</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多表删除"><span class="nav-number">1.8.</span> <span class="nav-text">多表删除</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mysql-高级应用"><span class="nav-number">2.</span> <span class="nav-text">Mysql 高级应用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#索引优化"><span class="nav-number">2.1.</span> <span class="nav-text">索引优化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#运行顺序"><span class="nav-number">2.1.1.</span> <span class="nav-text">运行顺序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#连接的方式"><span class="nav-number">2.1.2.</span> <span class="nav-text">连接的方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#索引的分类"><span class="nav-number">2.1.3.</span> <span class="nav-text">索引的分类</span></a></li></ol></li></ol></li></ol></div></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2019</span><span class="with-love" id="animate"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">Jack</span></div> "<div class="powered-by">Powered by <span class="exturl theme-link" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> v3.8.0</div> <span class="post-meta-divider">|</span><div class="theme-info">Theme – <span class="exturl theme-link" data-url="aHR0cHM6Ly90aGVtZS1uZXh0Lm9yZw==">NexT.Muse</span> v7.0.1</div> "<br><script type="text/javascript">var cnzz_s_tag=document.createElement("script");cnzz_s_tag.type="text/javascript",cnzz_s_tag.async=!0,cnzz_s_tag.charset="utf-8",cnzz_s_tag.src="https://w.cnzz.com/c.php?id=1276883782&async=1";var root_s=document.getElementsByTagName("script")[0];root_s.parentNode.insertBefore(cnzz_s_tag,root_s)</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span> <span class="post-meta-divider">|</span> <span id="busuanzi_container_site_uv">本站访客数<span id="busuanzi_value_site_uv"></span>人</span><br> <span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><script>var now=new Date;function createtime(){var n=new Date("04/01/2019 00:00:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="Run for "+dnum+" Days ",document.getElementById("times").innerHTML=hnum+" Hours "+mnum+" m "+snum+" s"}setInterval("createtime()",250)</script></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script>"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script src="/VEN/jquery/index.js?v=2.1.3"></script><script src="/VEN/velocity/velocity.min.js?v=1.2.1"></script><script src="/VEN/velocity/velocity.ui.min.js?v=1.2.1"></script><script src="/js/utils.js?v=7.0.1"></script><script src="/js/motion.js?v=7.0.1"></script><script src="/js/schemes/muse.js?v=7.0.1"></script><script src="/js/next-boot.js?v=7.0.1"></script><script src="/js/exturl.js?v=7.0.1"></script><script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script><script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script></body></html>